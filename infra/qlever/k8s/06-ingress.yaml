---
# QLever Ingress with Caddy (Automatic HTTPS via Let's Encrypt)
#
# Prerequisites:
# 1. Install Caddy Ingress Controller (see helm/caddy-ingress-values.yaml)
# 2. Configure DNS to point your domain to the LoadBalancer IP
# 3. Update spec.rules[0].host with your actual domain
#
# Caddy automatically obtains and renews Let's Encrypt certificates

apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: qlever-ingress
  namespace: qlever
  labels:
    app.kubernetes.io/name: qlever
    app.kubernetes.io/component: sparql-database
  annotations:
    kubernetes.io/ingress.class: caddy
    # Optional: Configure Caddy behavior
    # caddy.ingress.kubernetes.io/max-body-size: "100m"
spec:
  rules:
    - host: qlever.example.com  # ⚠️ CHANGE THIS to your domain
      http:
        paths:
          - path: /
            pathType: Prefix
            backend:
              service:
                name: qlever-server
                port:
                  number: 7001
  
  # TLS configuration
  # Caddy automatically obtains Let's Encrypt certificates for the hosts
  tls:
    - hosts:
        - qlever.example.com  # ⚠️ CHANGE THIS to your domain
      # secretName is optional - if omitted, Caddy generates cert automatically
      # secretName: qlever-tls  # Uncomment to use your own certificate

# ---
# Optional: Custom TLS certificate
# Uncomment and apply if you want to use your own certificate instead of Let's Encrypt
#
# apiVersion: v1
# kind: Secret
# metadata:
#   name: qlever-tls
#   namespace: qlever
# type: kubernetes.io/tls
# stringData:
#   tls.crt: |
#     -----BEGIN CERTIFICATE-----
#     <your certificate here>
#     -----END CERTIFICATE-----
#   tls.key: |
#     -----BEGIN PRIVATE KEY-----
#     <your private key here>
#     -----END PRIVATE KEY-----