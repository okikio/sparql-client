services:
  qlever-server:
    image: adfreiburg/qlever:latest
    container_name: qlever-server

    # M1 fix: you already proved amd64 works for indexing
    platform: linux/amd64

    # Not strictly required because your entrypoint does `cd /data`,
    # but it keeps everything consistent and avoids surprises.
    working_dir: /data

    env_file:
      - ./qlever.env

    volumes:
      # QLever working dir (Qleverfile + index artifacts)
      - ./output:/data
      
      # Your raw host data folder, mounted read-only
      - ./data:/input:ro

      # Your scripts
      - ./scripts:/qlever/scripts:ro

    # Override the image entrypoint completely
    entrypoint: ["/bin/bash", "/qlever/scripts/entrypoint.sh"]

    ports:
      - "7001:7001" # server

    restart: unless-stopped

  qlever-ui:
    image: adfreiburg/qlever-ui:latest
    container_name: qlever-ui
    depends_on:
      - qlever-server
    ports:
      - "7002:7000"
    restart: unless-stopped
    volumes:
      - qlever-ui-db:/app/db

volumes:
  qlever-ui-db:
